<!--TODO: standardize the path with the other controls-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="editor-cell.html">

<polymer-element name="wat-keyframe-editor" attribute="effect">
	<template>
		<style>
			#container {
				display: table-row;
			}
		</style>
		<div id="container"></div>
	</template>
	<script>
		Polymer('wat-keyframe-editor', {
			
			effect: null,

			effectChanged: function(oldValue, newValue) {
				this.createTable();
			},
			
			createTable: function() {
				
				var createGridItem = function(content, col, row) {
				
					var item = document.createElement("editor-cell");
					item.column = col;
					item.row = row;
					item.content = content;

					return item;
				}

				var frames = this.effect.getFrames();

				//find out all the properties need to be displayed
				//because every keyframe may have a different set of properties
				var found = {offset:true};
				var properties = [];

				var i, prop;
				//O(n * m) where n is #frames and m is #properties
				for(i = 0; i < frames.length; i++) {
				  	for(prop in frames[i]) {
					  
					 	if(found[prop]) {
						 	continue;
					  	}

					  	found[prop] = true;
					  	properties.push(prop);
				  	}
				}

				properties.sort();
				console.log(properties);

				container = this.$.container;

				//first create the topleft empty column
				var column = document.createElement("div");
				column.style.display = "table-cell";
				column.appendChild(createGridItem(null));
				
				//insert all the properties into the first column
				for(i = 0; i < properties.length; i++) {
					prop = properties[i];
					column.appendChild(createGridItem(prop));
				}

				container.appendChild(column);

				var frame;
				//insert all the frames into the table
				for(i = 0; i < frames.length; i++) {
					//each frame is a column grouped by a div
					frame = frames[i];
					column = document.createElement("div");
					column.style.display = "table-cell";
					column.appendChild(createGridItem(frame.offset));

					for(j = 0; j < properties.length; j++) {
						prop = properties[j];

						if(frame.hasOwnProperty(prop)) {
							column.appendChild(createGridItem(frame[prop]));
						} else {
							column.appendChild(createGridItem(null));
						}
					}

					container.appendChild(column);
				}

			}
		});
	</script>
</polymer-element>